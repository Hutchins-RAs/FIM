<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Data Sources | Economics Methodology</title>
  <meta name="description" content="2 Data Sources | Economics Methodology" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Data Sources | Economics Methodology" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Data Sources | Economics Methodology" />
  
  
  

<meta name="author" content="Lorae Stojanovic" />


<meta name="date" content="2024-07-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="data-processing.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.9/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data Sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#data-sources-1"><i class="fa fa-check"></i><b>2.1</b> Data sources</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#code-walk-through"><i class="fa fa-check"></i><b>2.2</b> Code walk-through</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-sources.html"><a href="data-sources.html#cbo"><i class="fa fa-check"></i><b>2.2.1</b> CBO</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-sources.html"><a href="data-sources.html#bea"><i class="fa fa-check"></i><b>2.2.2</b> BEA</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-sources.html"><a href="data-sources.html#haver"><i class="fa fa-check"></i><b>2.2.3</b> Haver</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#combining-wrangling"><i class="fa fa-check"></i><b>2.3</b> Combining &amp; wrangling</a></li>
<li class="chapter" data-level="2.4" data-path="data-sources.html"><a href="data-sources.html#the-clean-data"><i class="fa fa-check"></i><b>2.4</b> The clean data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>3</b> Data Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-processing.html"><a href="data-processing.html#input-data"><i class="fa fa-check"></i><b>3.1</b> Input data</a></li>
<li class="chapter" data-level="3.2" data-path="data-processing.html"><a href="data-processing.html#the-equations-that-actually-fovern-the-fim"><i class="fa fa-check"></i><b>3.2</b> The equations that actually fovern the FIM</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-processing.html"><a href="data-processing.html#mpc-subsection"><i class="fa fa-check"></i><b>3.2.1</b> MPC subsection</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-processing.html"><a href="data-processing.html#minus-neutral-subsection"><i class="fa fa-check"></i><b>3.2.2</b> minus neutral subsection</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-processing.html"><a href="data-processing.html#other-stuff-section"><i class="fa fa-check"></i><b>3.2.3</b> other stuff section</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ui-presentation.html"><a href="ui-presentation.html"><i class="fa fa-check"></i><b>4</b> UI Presentation</a></li>
<li class="chapter" data-level="5" data-path="economics-methodology.html"><a href="economics-methodology.html"><i class="fa fa-check"></i><b>5</b> Economics Methodology</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="economics-methodology.html"><a href="economics-methodology.html#marginal-propensities-to-consume"><i class="fa fa-check"></i><b>5.0.1</b> Marginal Propensities to Consume</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Economics Methodology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-sources" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Data Sources<a href="data-sources.html#data-sources" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="data-sources-1" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Data sources<a href="data-sources.html#data-sources-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will have to figure this section out. We draw from BEA, CBO, haver, etc. But we will need a flow chart of all the scripts, all the dependencies, and explain why each source is used for each item. When do we overwrite history?</p>
<p>We’ll probably have one sub section for each source, like:</p>
<p>The FIM draws from several sources of data each time it runs. It uses the BEA’s National Accounts data, accessed through Haver, to get history. It uses our own predictions for the forecast period. And it uses CBO for past and future potential GDP and GDP predictions.</p>
</div>
<div id="code-walk-through" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Code walk-through<a href="data-sources.html#code-walk-through" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s get nitty-gritty into the code. When the FIM runs, it starts with some messy initialization. It loads packages and defines some variables related to dates. This code should be made self-contained and put into its own script. But I (Lorae) haven’t gotten to that yet.</p>
<p>Note that this code is important and should be handled carefully. For example, variables like <code>last_month_year</code> and <code>month_year</code> are used several times in code that follows. When refactoring this section, tread lightly and test carefully.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-sources.html#cb2-1" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">TZ =</span> <span class="st">&#39;UTC&#39;</span>) <span class="co"># Set the default time zone to UTC (Coordinated Universal Time)</span></span>
<span id="cb2-2"><a href="data-sources.html#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="data-sources.html#cb2-3" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb2-4"><a href="data-sources.html#cb2-4" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb2-5"><a href="data-sources.html#cb2-5" tabindex="-1"></a>  tidyverse, </span>
<span id="cb2-6"><a href="data-sources.html#cb2-6" tabindex="-1"></a>  tsibble, </span>
<span id="cb2-7"><a href="data-sources.html#cb2-7" tabindex="-1"></a>  lubridate, </span>
<span id="cb2-8"><a href="data-sources.html#cb2-8" tabindex="-1"></a>  glue, </span>
<span id="cb2-9"><a href="data-sources.html#cb2-9" tabindex="-1"></a>  TimTeaFan<span class="sc">/</span>dplyover, </span>
<span id="cb2-10"><a href="data-sources.html#cb2-10" tabindex="-1"></a>  zoo, </span>
<span id="cb2-11"><a href="data-sources.html#cb2-11" tabindex="-1"></a>  TTR, </span>
<span id="cb2-12"><a href="data-sources.html#cb2-12" tabindex="-1"></a>  fs, </span>
<span id="cb2-13"><a href="data-sources.html#cb2-13" tabindex="-1"></a>  gt, </span>
<span id="cb2-14"><a href="data-sources.html#cb2-14" tabindex="-1"></a>  openxlsx, </span>
<span id="cb2-15"><a href="data-sources.html#cb2-15" tabindex="-1"></a>  snakecase, </span>
<span id="cb2-16"><a href="data-sources.html#cb2-16" tabindex="-1"></a>  rlang, </span>
<span id="cb2-17"><a href="data-sources.html#cb2-17" tabindex="-1"></a>  BrookingsInstitution<span class="sc">/</span>ggbrookings</span>
<span id="cb2-18"><a href="data-sources.html#cb2-18" tabindex="-1"></a>  )</span>
<span id="cb2-19"><a href="data-sources.html#cb2-19" tabindex="-1"></a><span class="co"># Load all functions in package (?!?)</span></span>
<span id="cb2-20"><a href="data-sources.html#cb2-20" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>() </span>
<span id="cb2-21"><a href="data-sources.html#cb2-21" tabindex="-1"></a></span>
<span id="cb2-22"><a href="data-sources.html#cb2-22" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">4</span>) <span class="co"># Limit number of digits</span></span>
<span id="cb2-23"><a href="data-sources.html#cb2-23" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">20</span>)<span class="co"># Turn off scientific notation under 20 digits </span></span>
<span id="cb2-24"><a href="data-sources.html#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="data-sources.html#cb2-25" tabindex="-1"></a><span class="co">#are we running this after a cbo baseline and pre-bea update?</span></span>
<span id="cb2-26"><a href="data-sources.html#cb2-26" tabindex="-1"></a>post_cbo_baseline<span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb2-27"><a href="data-sources.html#cb2-27" tabindex="-1"></a><span class="co"># Set the value of &#39;month_year&#39; to the current month and year (in the format &quot;mm-yyyy&quot;)</span></span>
<span id="cb2-28"><a href="data-sources.html#cb2-28" tabindex="-1"></a>month_year <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&#39;{format.Date(today() - 7, &quot;%m&quot;)}-{year(today())}&#39;</span>)</span>
<span id="cb2-29"><a href="data-sources.html#cb2-29" tabindex="-1"></a><span class="fu">print</span>(month_year)</span>
<span id="cb2-30"><a href="data-sources.html#cb2-30" tabindex="-1"></a></span>
<span id="cb2-31"><a href="data-sources.html#cb2-31" tabindex="-1"></a><span class="co"># Calculate the current date minus 7 days</span></span>
<span id="cb2-32"><a href="data-sources.html#cb2-32" tabindex="-1"></a>current_date <span class="ot">&lt;-</span> <span class="fu">today</span>() <span class="sc">-</span> <span class="fu">dweeks</span>(<span class="dv">1</span>)</span>
<span id="cb2-33"><a href="data-sources.html#cb2-33" tabindex="-1"></a><span class="co"># Calculate the previous month date, handling wraparound (i.e. previous</span></span>
<span id="cb2-34"><a href="data-sources.html#cb2-34" tabindex="-1"></a><span class="co"># month to January (&quot;01&quot;) is December (&quot;12&quot;), not month &quot;0&quot;)</span></span>
<span id="cb2-35"><a href="data-sources.html#cb2-35" tabindex="-1"></a>last_month_date <span class="ot">&lt;-</span> current_date <span class="sc">%m-%</span> <span class="fu">months</span>(<span class="dv">1</span>)</span>
<span id="cb2-36"><a href="data-sources.html#cb2-36" tabindex="-1"></a><span class="co"># Extract and format the month as a two-digit string</span></span>
<span id="cb2-37"><a href="data-sources.html#cb2-37" tabindex="-1"></a>last_month_2digit <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%02d&quot;</span>, <span class="fu">month</span>(last_month_date))</span>
<span id="cb2-38"><a href="data-sources.html#cb2-38" tabindex="-1"></a><span class="co"># Extract the year from the last_month_date</span></span>
<span id="cb2-39"><a href="data-sources.html#cb2-39" tabindex="-1"></a>last_year <span class="ot">&lt;-</span> <span class="fu">year</span>(last_month_date)</span>
<span id="cb2-40"><a href="data-sources.html#cb2-40" tabindex="-1"></a><span class="co"># Create last_month_year string for file naming</span></span>
<span id="cb2-41"><a href="data-sources.html#cb2-41" tabindex="-1"></a>last_month_year <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&#39;{last_month_2digit}-{last_year}&#39;</span>)</span>
<span id="cb2-42"><a href="data-sources.html#cb2-42" tabindex="-1"></a></span>
<span id="cb2-43"><a href="data-sources.html#cb2-43" tabindex="-1"></a><span class="fu">print</span>(last_month_year)</span></code></pre></div>
<p>This next section of code primarily serves to define empty folders that will be populated upon running the FIM. This section could also use a clean-up, but it relies on some variables produced in the previous code chunk. Perhaps the two sections should be bundled together upon refactoring.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-sources.html#cb3-1" tabindex="-1"></a><span class="co">#setting our reference period to be the post-cbo files if we&#39;ve already produced</span></span>
<span id="cb3-2"><a href="data-sources.html#cb3-2" tabindex="-1"></a><span class="co"># fim output incorporating the cbo update</span></span>
<span id="cb3-3"><a href="data-sources.html#cb3-3" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="fu">glue</span>(<span class="st">&#39;results/{month_year}-post-cbo&#39;</span>))){</span>
<span id="cb3-4"><a href="data-sources.html#cb3-4" tabindex="-1"></a>  last_month_year<span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&#39;{month_year}-post-cbo&#39;</span>)</span>
<span id="cb3-5"><a href="data-sources.html#cb3-5" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="data-sources.html#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="data-sources.html#cb3-7" tabindex="-1"></a><span class="co"># Create folder for current update in the results directory</span></span>
<span id="cb3-8"><a href="data-sources.html#cb3-8" tabindex="-1"></a><span class="fu">dir_create</span>(<span class="fu">glue</span>(<span class="st">&#39;results/{month_year}&#39;</span>)) </span>
<span id="cb3-9"><a href="data-sources.html#cb3-9" tabindex="-1"></a><span class="co"># Folder to store forecast sheet from current update</span></span>
<span id="cb3-10"><a href="data-sources.html#cb3-10" tabindex="-1"></a><span class="fu">dir_create</span>(<span class="fu">glue</span>(<span class="st">&#39;results/{month_year}/input_data&#39;</span>)) </span>
<span id="cb3-11"><a href="data-sources.html#cb3-11" tabindex="-1"></a><span class="co"># Beta folder for Lorae&#39;s refactored results</span></span>
<span id="cb3-12"><a href="data-sources.html#cb3-12" tabindex="-1"></a><span class="fu">dir_create</span>(<span class="fu">glue</span>(<span class="st">&#39;results/{month_year}/beta&#39;</span>))</span>
<span id="cb3-13"><a href="data-sources.html#cb3-13" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="data-sources.html#cb3-14" tabindex="-1"></a><span class="co"># Copy the file &#39;forecast.xlsx&#39; from the &#39;data&#39; directory to the &#39;input_data&#39; directory</span></span>
<span id="cb3-15"><a href="data-sources.html#cb3-15" tabindex="-1"></a><span class="co"># This is the copy we keep for the current update</span></span>
<span id="cb3-16"><a href="data-sources.html#cb3-16" tabindex="-1"></a><span class="fu">file_copy</span>(</span>
<span id="cb3-17"><a href="data-sources.html#cb3-17" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">&#39;data/forecast.xlsx&#39;</span>, </span>
<span id="cb3-18"><a href="data-sources.html#cb3-18" tabindex="-1"></a>  <span class="at">new_path =</span> <span class="fu">glue</span>(<span class="st">&#39;results/{month_year}/input_data/forecast_{month_year}.xlsx&#39;</span>), </span>
<span id="cb3-19"><a href="data-sources.html#cb3-19" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb3-20"><a href="data-sources.html#cb3-20" tabindex="-1"></a>  )</span></code></pre></div>
<p>This next section reads in raw data. I’ve taken pains to attempt to trace back where the inputs in this project arise. As you can see, there are two crucial .rds files saved in the FIM. I’m not exactly sure how they are overwritten, and understanding where they are replaced is a crucial part of the FIM restructuring process.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-sources.html#cb4-1" tabindex="-1"></a><span class="co"># Load in national accounts</span></span>
<span id="cb4-2"><a href="data-sources.html#cb4-2" tabindex="-1"></a>fim<span class="sc">::</span>national_accounts <span class="co"># this is the literal df</span></span>
<span id="cb4-3"><a href="data-sources.html#cb4-3" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/national_accounts.rda&quot;</span>) <span class="co"># this loads in a df named national_accounts</span></span>
<span id="cb4-4"><a href="data-sources.html#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="data-sources.html#cb4-5" tabindex="-1"></a><span class="co"># Load in projections</span></span>
<span id="cb4-6"><a href="data-sources.html#cb4-6" tabindex="-1"></a>fim<span class="sc">::</span>projections <span class="co"># this is the literal df</span></span>
<span id="cb4-7"><a href="data-sources.html#cb4-7" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/projections.rda&quot;</span>) <span class="co"># this loads in a df named projections</span></span></code></pre></div>
<p>This section reads in historical overrides. Historical overrides are data observations in the past that we take as given. Every time this code runs, it extracts raw historic data from Haver and attempts to use that. However, for some time series, we do not want to use what Haver gives us. Instead, we override that data. These overrides are crucial to that process.</p>
<p>If we have to override each time, why do we even bother reading in the raw data? It’s history, right? Well, not really. The data series we use as inputs in the FIM occasionally get revised. We want that most recent revision, because it’s most accurate. However, we want to make sure that these revisions don’t overwrite our historical overrides.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-sources.html#cb5-1" tabindex="-1"></a><span class="co"># Read in historical overrides from data/forecast.xlsx</span></span>
<span id="cb5-2"><a href="data-sources.html#cb5-2" tabindex="-1"></a><span class="co"># Since BEA put all CARES act grants to S&amp;L in Q2 2020 we need to</span></span>
<span id="cb5-3"><a href="data-sources.html#cb5-3" tabindex="-1"></a><span class="co"># override the historical data and spread it out based on our best guess</span></span>
<span id="cb5-4"><a href="data-sources.html#cb5-4" tabindex="-1"></a><span class="co"># for when the money was spent.</span></span>
<span id="cb5-5"><a href="data-sources.html#cb5-5" tabindex="-1"></a>historical_overrides <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&#39;data/forecast.xlsx&#39;</span>,</span>
<span id="cb5-6"><a href="data-sources.html#cb5-6" tabindex="-1"></a>                                          <span class="at">sheet =</span> <span class="st">&#39;historical overrides&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># Read in historical_overrides</span></span>
<span id="cb5-7"><a href="data-sources.html#cb5-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> <span class="co"># Remove longer name since we don&#39;t need it</span></span>
<span id="cb5-8"><a href="data-sources.html#cb5-8" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>variable,</span>
<span id="cb5-9"><a href="data-sources.html#cb5-9" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&#39;date&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># Reshape so that variables are columns and dates are rows</span></span>
<span id="cb5-10"><a href="data-sources.html#cb5-10" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&#39;variable&#39;</span>,</span>
<span id="cb5-11"><a href="data-sources.html#cb5-11" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&#39;value&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="data-sources.html#cb5-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">yearquarter</span>(date))</span>
<span id="cb5-13"><a href="data-sources.html#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="data-sources.html#cb5-14" tabindex="-1"></a><span class="co"># Read in deflator overrides from data/forecast.xlsx</span></span>
<span id="cb5-15"><a href="data-sources.html#cb5-15" tabindex="-1"></a>deflator_overrides <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&#39;data/forecast.xlsx&#39;</span>,</span>
<span id="cb5-16"><a href="data-sources.html#cb5-16" tabindex="-1"></a>                                        <span class="at">sheet =</span> <span class="st">&#39;deflators_override&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># Read in overrides for deflators</span></span>
<span id="cb5-17"><a href="data-sources.html#cb5-17" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> <span class="co"># Remove longer name since we don&#39;t need it</span></span>
<span id="cb5-18"><a href="data-sources.html#cb5-18" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>variable,</span>
<span id="cb5-19"><a href="data-sources.html#cb5-19" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&#39;date&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># Reshape so that variables are columns and dates are rows</span></span>
<span id="cb5-20"><a href="data-sources.html#cb5-20" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&#39;variable&#39;</span>,</span>
<span id="cb5-21"><a href="data-sources.html#cb5-21" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&#39;value&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-22"><a href="data-sources.html#cb5-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">yearquarter</span>(date))</span></code></pre></div>
<p>This next code chunk seriously needs attention. We certainly should not be setting the current quarter this far down in the code and intermingling it with our data pipeline. It should be somewhere in the top of the code.</p>
<p>Why haven’t I changed it yet? Well, it relies on the data frames we load. I haven’t had time to come up with a better way of doing it. But this one line of code needs serious attention.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-sources.html#cb6-1" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: This current quarter should be calculated at the top, for the entirety</span></span>
<span id="cb6-2"><a href="data-sources.html#cb6-2" tabindex="-1"></a><span class="co"># of the FIM, not buried down here.</span></span>
<span id="cb6-3"><a href="data-sources.html#cb6-3" tabindex="-1"></a><span class="co"># Save current quarter for later</span></span>
<span id="cb6-4"><a href="data-sources.html#cb6-4" tabindex="-1"></a>current_quarter <span class="ot">&lt;-</span> historical_overrides <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(date) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(date) </span></code></pre></div>
<p>—- end of code walk through, for now!</p>
<p>We’ll probably have one sub section for each source, like:</p>
<div id="cbo" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> CBO<a href="data-sources.html#cbo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>stuff here. Which reports do we use? Budget? Economic? How do we input their data into the FIM?</p>
</div>
<div id="bea" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> BEA<a href="data-sources.html#bea" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Same questions as above</p>
</div>
<div id="haver" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Haver<a href="data-sources.html#haver" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Discuss Haver package, etc.</p>
</div>
</div>
<div id="combining-wrangling" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Combining &amp; wrangling<a href="data-sources.html#combining-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I have no idea how this is done, and we will have to refactor this section in depth.</p>
</div>
<div id="the-clean-data" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> The clean data<a href="data-sources.html#the-clean-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We use the “projections” data frame (at least for now) in the remainder of the code. In its current refactored state in the fiscal_impact_BETA script, we select columns of interest from the lonnngggg “projections” data frame and use those as we calculate the FIM.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-processing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
