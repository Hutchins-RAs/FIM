---
title: "Data Sources"
---

# Data Sources

## Data sources

We will have to figure this section out. We draw from BEA, CBO, haver, etc. But we will need a flow chart of all the scripts, all the dependencies, and explain why each source is used for each item. When do we overwrite history?

We'll probably have one sub section for each source, like:

The FIM draws from several sources of data each time it runs. It uses the BEA's National Accounts data, accessed through Haver, to get history. It uses our own predictions for the forecast period. And it uses CBO for past and future potential GDP and GDP predictions.

## Code walk-through

```{r setup-01, include=FALSE}
# This chunk reads in code from fiscal_impact_BETA.R so that this .Rmd file can
# display it. Please note that the sections of code shown below are demarcated using
# their chunk names, which are marked in this style:
# ---- chunk-name-example ----
knitr::read_chunk("../../fiscal_impact_BETA.R")
```

Let's get nitty-gritty into the code. When the FIM runs, it starts with some messy initialization. It loads packages and defines some variables related to dates. This code should be made self-contained and put into its own script. But I (Lorae) haven't gotten to that yet.

Note that this code is important and should be handled carefully. For example, variables like `last_month_year` and `month_year` are used several times in code that follows. When refactoring this section, tread lightly and test carefully.

```{r section-A.1-prep-for-update, eval=FALSE, echo=TRUE}
# This code block prints the chunk entitled "section-A.1-prep-for-update" from
# fiscal_impact_BETA.R
```

This next section of code primarily serves to define empty folders that will be populated upon running the FIM. This section could also use a clean-up, but it relies on some variables produced in the previous code chunk. Perhaps the two sections should be bundled together upon refactoring.

```{r section-A.2-create-empty-directories, eval=FALSE, echo=TRUE}
# This code block prints the chunk entitled "section-A.2-create-empty-directories" 
# from fiscal_impact_BETA.R
```

This next section reads in raw data. I've taken pains to attempt to trace back where the inputs in this project arise. As you can see, there are two crucial .rds files saved in the FIM. I'm not exactly sure how they are overwritten, and understanding where they are replaced is a crucial part of the FIM restructuring process.

```{r section-B.0-read-raw-rds-data, eval=FALSE, echo=TRUE}
# This code block prints the chunk entitled "section-B.0-read-raw-rds-data" 
# from fiscal_impact_BETA.R
```

This section reads in historical overrides. Historical overrides are data observations in the past that we take as given. Every time this code runs, it extracts raw historic data from Haver and attempts to use that. However, for some time series, we do not want to use what Haver gives us. Instead, we override that data. These overrides are crucial to that process.

If we have to override each time, why do we even bother reading in the raw data? It's history, right? Well, not really. The data series we use as inputs in the FIM occasionally get revised. We want that most recent revision, because it's most accurate. However, we want to make sure that these revisions don't overwrite our historical overrides.

```{r section-B.1-read-overrides, eval=FALSE, echo=TRUE}
# This code block prints the chunk entitled "section-B.1-read-overrides" 
# from fiscal_impact_BETA.R
```

This next code chunk seriously needs attention. We certainly should not be setting the current quarter this far down in the code and intermingling it with our data pipeline. It should be somewhere in the top of the code.

Why haven't I changed it yet? Well, it relies on the data frames we load. I haven't had time to come up with a better way of doing it. But this one line of code needs serious attention.
```{r section-B.2-set-current-quarter, eval=FALSE, echo=TRUE}
# This code block prints the chunk entitled "section-B.2-set-current-quarter" 
# from fiscal_impact_BETA.R
```

---- end of code walk through, for now!

We'll probably have one sub section for each source, like:

### CBO
stuff here. Which reports do we use? Budget? Economic? How do we input their data into the FIM?

### BEA
Same questions as above

### Haver
Discuss Haver package, etc.

## Combining & wrangling

I have no idea how this is done, and we will have to refactor this section in depth. 

## The clean data
We use the "projections" data frame (at least for now) in the remainder of the code. In its current refactored state in the fiscal_impact_BETA script, we select columns of interest from the lonnngggg "projections" data frame and use those as we calculate the FIM.
